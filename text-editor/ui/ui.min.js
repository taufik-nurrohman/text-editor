/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.2.0
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.ui=function(e,t){function _e(e){return e.toLowerCase()}function Me(e){return _(e)?m(e).split(/\s+/):e}function Oe(e){return $(e)?e.join(" "):e}function Ne(e,t){return-1!==e.indexOf(t)}function De(e){return Object.keys(e)}function He(e){return e.length}function Ae(e){return He(De(e))}function Be(e,t,n){return C(e)?C(t)?(C(g[e])||(g[e]={}),C(n)||(n=Ae(g[e])),g[e][n]=t,l):g[e]:g}function Se(e,t){return C(e)?C(t)&&C(g[e])?(delete g[e][t],l):(g[e]={},l):(g={},l)}function Ye(e,t,n){if(!C(g[e]))return g[e]={},l;if(C(n))C(g[e][n])&&g[e][n].apply(l,t);else for(X in g[e])g[e][X].apply(l,t);return l}function je(e,t,n){if($(t))for(X in t)je(e,X,t[X]);else e[(null===n?"remove":"set")+"Attribute"](t,n)}function Fe(e,n,i){if(!n){for(t={},X=0,q=e.attributes,K=He(q);K>X;++X)P=q[X],t[P.name]=P.value;return Ae(t)?t:C(i)?i:{}}if(_(n))return Fe(e,[n],[C(i)?i:""])[0];t=[];for(X in n)X=n[X],X=e.getAttribute(X)||"",t.push(X);return He(t)?t:C(i)?i:[]}function Ie(e,t){if($(t))for(X in t)Ie(e,t[X]);else if(C(t))e.removeAttribute(t);else for(Ie(e,"class"),X=0,q=e.attributes,K=He(q);K>X;++X)q[X]&&Ie(e,q[X].name)}function We(e,t,n){if($(t))for(X in t)We(e,X,t[X]);else je(e,"data-"+t,n)}function Xe(e,n,i){if(!n){for(t={},X=0,q=e.attributes,K=He(q);K>X;++X)P=q[X],"data-"===P.name.slice(0,5)&&(t[P.name]=P.value);return Ae(t)?t:C(i)?i:{}}if(_(n))return Xe(e,[n],[C(i)?i:""])[0];t=[];for(X in n)X=n[X],X=Fe(e,"data-"+X),t.push(X);return He(t)?t:C(i)?i:[]}function qe(e,t){if($(t))for(X in t)Ie(e,"data-"+t[X]);else if(C(t))Ie(e,"data-"+t);else for(X=0,q=e.attributes,K=He(q);K>X;++X)q[X]&&"data-"===q[X].name.slice(0,5)&&Ie(e,q[X].name)}function Ke(e){return e&&e.preventDefault(),!1}function Pe(e,t,n){if(t){for(e=Me(e),X=0,q=He(e);q>X;++X)t.addEventListener(e[X],n,!1),Be("on:"+e[X],n,st(t));return l}}function Re(e,t,n){if(t){for(e=Me(e),X=0,q=He(e);q>X;++X)t.removeEventListener(e[X],n,!1),Se("on:"+e[X],st(t));return E(t)&&t.id.split(":")[0]===Dt+"-dom"&&Ie(t,"id"),l}}function Ue(e,t,n){e=Me(e);var r,i="createEvent"in u;for(X=0,q=He(e);q>X;++X)i?(r=u.createEvent("HTMLEvents"),r.data=n,r.initEvent(e[X],!0,!1),t.dispatchEvent(r)):Ye("on:"+e[X],n,st(t));return l}function Ze(e,t,n){for(X=0,q=He(t),K;q>X;++X)K=t[X],e=e.replace(L(K)?K:h(p(K),"g"),n&&n[X]||"");return e}function Ge(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,C(t[n])?t[n]:e})}function Je(e){return m(Ze(_e(e),[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function Qe(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,i=t.touches?t.touches[0].pageY:t.pageY,r=Ve(e);return{x:n-r.l,y:i-r.t}}function Ve(e){for(P=e.offsetLeft,V=e.offsetTop;e=e.offsetParent;)P+=e.offsetLeft,V+=e.offsetTop;return{l:P,t:V}}function et(e){return e===s?{w:e.innerWidth,h:e.innerHeight}:{w:e.offsetWidth,h:e.offsetHeight}}function tt(e,t){for(;(e=dt(e))&&e!==t;);return e}function nt(e,t){t=Me(t);for(X in t)e.classList.add(t[X])}function it(e,n,i){if(!n)return t=Me(e.className),He(t)?t:C(i)?i:[];if(_(n))return it(e,[n],[C(i)?i:""])[0];t=[];for(X in n)X=n[X],e.classList.contains(X)&&t.push(X);return He(t)?t:C(i)?i:[]}function rt(e,t){if(C(t)){t=Me(t);for(X in t)e.classList.remove(t[X])}else Ie(e,"class")}function ft(e,t){t=Me(t);for(X in t)e.classList.toggle(t[X])}function ot(e,t,n){if(e=e||"div",e=_(e)?u.createElement(e):e,$(n)){t||(C(n.html)?(t=n.html,delete n.html):C(n.text)&&(t=n.text,delete n.text));for(X in n)if(te=n[X],"classes"===X)nt(e,te);else if("data"===X)for(q in te)te=te[q],null===te?qe(e,q):We(e,q,te);else"css"===X?_(te)?je(e,"style",te):null===te?Ie(e,"style"):c(e,te):T(te)?e[X]=te:null===te?Ie(e,X):je(e,X,w(te)?te.join(" "):""+te)}if(E(t))zt(e,t);else if($(t))for(X in t)te=t[X],E(te)?zt(e,te):te!==!1&&ut(e,te);else C(t)&&t!==!1&&ut(e,t);return e}function st(e){var t=e.id;return t||(t=Dt+"-dom:"+Math.floor(Date.now()*Math.random()),e.id=t),t}function ut(e,t){e.innerHTML=t}function lt(e,t){return e.innerHTML||(C(t)?t:"")}function at(e,t){if((!C(t)||t)&&(S=pt(e)))for(X=0,q=He(S);q>X;++X)at(S[X]);ut(e,"")}function ct(e){return Array.prototype.slice.call(e)}function dt(e){return e&&e.parentNode}function pt(e){return e&&ct(e.children||[])}function bt(e,t){return C(t)?_(t)?e.closest(t):tt(e,t):dt(e)}function ht(e){return e&&e.nextElementSibling}function yt(e){return e&&e.previousElementSibling}function xt(e){for(X=0;e=yt(e);)++X;return X}function mt(e,t){return e&&_(t)?_e(e.nodeName)===_e(t):e&&T(t)?e===t(e):e===t}function gt(e,t){return(t=C(t)?t:u)?_(e)?/^[#.]?(?:\\.|[\w-]|[^\x00-\xa0])+$/.test(e)?"#"===e[0]&&(e=t.getElementById(e.slice(1)))?[e]:"."===e[0]&&(e=t.getElementsByClassName(e.slice(1)))||(e=t.getElementsByTagName(e))?ct(e):[]:ct(t.querySelectorAll(e)):vt(e)?[e]:[]:[]}function vt(e,t){var n=dt(e);return 1===He(arguments)?n||!1:e&&n===e?n:!1}function kt(e,t){Z=dt(e),Z&&Z.insertBefore(t,e)}function Et(e,t){Z=dt(e),Z&&Z.insertBefore(t,ht(e))}function wt(e,t){S=e.firstChild,S?kt(S,t):zt(e,t)}function Tt(e,t){zt(e,t)}function zt(e,t){e.appendChild(t)}function $t(e,t){var n=dt(e);if(n){if(!C(t)||t)for(S=e.firstChild;S;)$t(S);n.removeChild(e)}}function Lt(e,t){return e.cloneNode(C(t)?!!t:!0)}function Ct(e,t){return dt(e).replaceChild(t,e),t}function _t(e){at(ot(e,!1,{style:""})),$t(e)}function Mt(e,t,n){return ot(t,n,{"class":e})}function fn(e){return!e||C(e.active)&&!e.active}function on(e,t,n){return T(e)&&(e={click:e}),_(e.click)&&(e.click=(n[e.click]||{}).click),e.title=Ht[t]||"",C(e.attributes)||(e.attributes={}),n[t]&&(n[t]=e),e}function sn(e){Ot.exit(0,0,0);var t=Xe(this,"tool-id"),n=Ot.tools,i=n[t];return Ot.drop.target=e.currentTarget||e.target,!fn(i)&&T(q=i.click)&&(q=q(e,l,t),Ye("on:change",[e,l,t]),q===!1)?Ke(e):(l.select(),Ke(e))}function un(e){if(V=this,(K=e.TE.key)(["escape","f10"]))Ot.exit(1);else if(K("enter")||K("down")&&Xe(V,"ui-drop"))Ot.drop.target=V,Ue(se,V,[e]);else if(K("right")&&(P=ht(V))){for(;!mt(P,"a")&&P;)P=ht(P);P&&P.focus()}else if(K("left")&&(P=yt(V))){for(;!mt(P,"a")&&P;)P=yt(P);P&&P.focus()}return Ke(e)}function an(){at(qt,0);var r,f,o,s,u,a,c,e=Ot.tools,t=Me(D.tools),n=Dt+"-button",i=Dt+"-separator";D.tools=t;for(a in t)c=t[a],f=e[c],(f||f==={})&&(f=on(f,c,e),o=f.i||c,"|"===o||Ne(o,"<")||(o=Je(o)),s="|"!==o,u=Je(c).replace(/[\/\s]/g,"-"),nn=Mt(s?n+" "+n+"-"+u:i+" "+i+"-"+a,s?"a":"span"),s?(nn=f.target||nn,r=n+":"+u,je(nn,{href:Le,id:r,tabindex:-1}),We(nn,"tool-id",c),o=Ne(o,"<")?o:Ot.i(u,o),fn(f)?nt(nn,"x"):rt(nn,"x"),f.on?nt(nn,"on"):rt(nn,"on"),f.text&&(o=Ge('<span class="'+Dt+'-text">'+f.text+"</span>",[o]),nt(nn,"text")),ut(nn,o),ot(nn,!1,f.attributes),!f.attributes.title&&(q=f.title)&&(nn.title=$(q)?q[0]+(q[1]?" ("+q[1]+")":""):q),Pe(se,nn,sn),Pe(de,nn,un)):nn.id=i+":"+a,f.target=nn,(u=Xe(nn,ln))&&Ot.menu.set(c,u),zt(qt,nn));Ye("update.tools",[l])}function cn(){Ot.keys=function(){var n,e=De(Ot.keys).sort().reverse(),t={};for(X=0,q=He(e);q>X;++X)n=e[X],t[n]=Ot.keys[n];return t}(),pn(),Ye("update.keys",[l])}function dn(e){function b(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var n=l.$(),i=n.before,r=n.after,f=i.slice(-1),o=r[0],s=n.length,u=Ot.keys,a=TE.keys_a,c={control:0,shift:0,option:"alt",meta:0},d=(i.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();for(X in c)e.TE[X]()&&(H[c[X]||X]=1);U=e.TE.key(),H[U]=1,t=Ae(H),x(function(){l.record()});for(X in u){K=b(X),S=0;for(q in K)q=K[q],H[a[q]||q]&&++S;if(K=He(K),S===K&&t===K&&(_(u[X])&&(u[X]=Ot.tools[u[X]].click),P=T(u[X])&&u[X](e,l),P===!1))return Ke(e)}if(ge)for(X in ge)if(R=ge[X],R!==!1){if(U===R&&o===R)return"\\"===f?(l.insert(U,0),Ke(e)):(l.select(n.end+1),Ke(e));if(X===U)return l.wrap(X,R),Ke(e);if(f===X&&o===R){if("backspace"===U&&i.slice(-2)!=="\\"+X)return l.unwrap(X,R),Ke(e);if(ve&&"enter"===U&&X!==R&&!s)return l.tidy("\n"+d+Ee,"\n"+d).scroll(1),Ke(e)}}if(ve&&!s){if("backspace"===U&&h(p(Ee)+"$").test(i))return l.outdent(Ee),Ke(e);if("enter"===U&&h("(^|\\n)("+p(Ee)+")+.*$").test(i))return l.insert("\n"+d,0,1).scroll(1),Ke(e)}}function pn(e){e&&e.TE&&e.TE.key?delete H[e.TE.key()]:H={}}function mn(e){return bn=Yt,Q=et(Xt),Ke(e)}function gn(e){bn===Yt&&c(Kt,{height:Qe(Wt,e).y-Q.h+Ce})}function vn(){bn=0}function kn(){Ot.exit(1)}function En(){t=et(Zt),ne=t.w,W=t.h,t=et(Ut),hn=t.w,yn=t.h}function wn(e,t){return t&&Ye("exit.modal."+t,[l]),Ue(se,Ut,[e]),Ke(e)}function Tn(e){bn=e.target,t=Qe(Zt,e),ie=t.x,re=t.y,En()}function zn(e){var n=xn.header,i=xn.sizer;bn===n||tt(bn,n)===n?(t=Qe(Wt,e),P=t.x-ie,V=t.y-re,c(Zt,{left:(ne>hn?P:d(P,0,hn-ne))+Ce,top:(W>yn?V:d(V,0,yn-W))+Ce})):bn===i&&(t=Qe(Zt,e),Q=et(i),c(Zt,{width:t.x+Q.w/4+Ce,height:t.y+Q.h/4+Ce}))}function $n(){bn=0}function Ln(e,t,n){return{header:e,body:t,footer:n}}function Cn(e){A=Ot.drop.target,B=Gt,S=e&&e.target||0,(!S||S!==A&&tt(S,A)!==A)&&(Ot.drop.target=0,Ot.exit(S===Kt))}var A,B,S,F,W,X,q,K,P,R,U,t,Z,J,Q,V,ee,te,ne,ie,re,n="⌘",i="…",f="⇥",o="⇧",s=window,u=document,l=new TE(e),a=l._,c=a.css,d=a.edge,p=a.x,b=a.extend,h=a.pattern,y=a.timer.reset,x=a.timer.set,m=a.trim,g={},v=function(){},k=TE.is,E=k.e,w=k.a,T=k.f,z=k.i,$=k.o,L=k.r,C=function(e){return!k.x(e)},_=k.s,M=u.documentElement,N=(u.head,u.body),D=b({tab:"  ",direction:"ltr",path:TE.path,resize:1,keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},union:[[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]],[["<",">","/"],["=",'"','"'," "]]],auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{tools:["Focus Tools","F10"],undo:["Undo",n+"+Z"],redo:["Redo",n+"+Y"],indent:["Indent",f],outdent:["Outdent",o+"+"+f]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+i},labels:{},others:{}},classes:{"":"text-editor",i:"text-editor-i text-editor-i-%1 text-editor-i-%2"}},t),H={},oe="blur",se="click",de="keydown",pe="keyup",be="touchstart mousedown",he="touchmove mousemove",ye="touchend mouseup",me="orientationchange resize",ge=D.auto_close,ve=D.auto_tab,ke=D.languages,Ee=D.tab,Te=(D.union[1][1],D.union[1][0]),ze=D.union[0][1],$e=D.union[0][0],Le="javascript:;",Ce="px",Ot=l.ui={};l.tidy=function(e,t){var n=l.$(),i=m(n.before)?e:"",r=m(n.after)?C(t)?t:e:"";return l.trim(i,r)},l.i=function(){return m(l.replace(/\s+/g," "))},l.format=function(e,t,n,i){$(e)||(e=[e]),C(n)||(n=" "),C(i)||(i="");var r=l.h,f=l[0]().$(),o=e[0].split(h("("+ze[3]+")+"))[0],s=(e[0]?Te[0]+e[0]+Te[1]:"")+i,u=i+(e[0]?Te[0]+Te[2]+(e[1]||o)+Te[1]:""),a=p(e[0]?Te[0]+o+Te[1]:""),c=p(u),d=h("^"+a+"([\\s\\S]*?)"+c+"$"),b=h(a+"$"),y=h("^"+c),x=f.before,m=f.after;return f.length?n=!1:l.insert(ke.placeholders[""]),l.toggle(t?!d.test(f.value):!b.test(x)&&!y.test(m),[function(e){e.unwrap(s,u,1).tidy(h($e[0]+"[^"+$e[0]+$e[1]+$e[2]+"]+?"+$e[1]+"$").test(x)?"":n,h("^"+$e[0]+$e[2]+"[^"+$e[0]+$e[1]+"]+?"+$e[1]).test(m)?"":n).wrap(s,u,t)},function(e){e.unwrap(s,u,t)}])[r]()};var nn,Nt=D.classes,Dt=Nt[""],Ht=ke.tools,At=ke.buttons,Bt=ke.labels,St=Dt+"-textarea "+Dt+"-content block",Yt=Mt(Dt+"-sizer s"),jt=Mt(Dt+"-sizer se"),Ft=Mt(Dt),It=Mt(Dt+"-header"),Wt=Mt(Dt+"-body"),Xt=Mt(Dt+"-footer"),qt=Mt(Dt+"-tool"),Kt=ot(e,!1,D.attributes),Pt=Mt(Dt+"-description"),Rt=ot(),Ut=ot(),Zt=ot(),Gt=ot(),Jt=ot(),Qt=ot(),Vt=Mt("left","span"),en=Mt("right","span"),tn=0;Ot.i=function(e,t,n){return e=Je(e).replace(/[\/\s]/g,"-"),Q=Ge(Nt.i,[e,t||e]),n?(rt(n),nt(n,Q),n):'<i class="'+Q+'"></i>'},C(D.suffix)||(D.suffix=Te[1]);var ln="ui-drop-data",bn=0,ie=0,re=0,ne=0,W=0,hn=0,yn=0,xn={};l.create=function(e,t){if(l.is.create)return l;l.is.create=!0,$(e)&&(D=b(D,e));var n=vt(Kt);return nt(Ft,Dt+"-is-can-update"),nt(Ft,Dt+"-is-can-copy"),nt(Kt,St),n&&mt(n,"p")?(kt(n,Ft),tn=n,$t(n,!1)):kt(Kt,Ft),Ft.dir=D.direction,zt(Ft,It),zt(Ft,Wt),zt(Ft,Xt),zt(Wt,Kt),D.tools&&(zt(It,qt),zt(Xt,Pt),zt(Pt,Vt),zt(Pt,en)),Pe(de,Kt,dn),Pe(pe+" "+oe,Kt,pn),U=Dt+"-is-can-resize",D.resize?(zt(Ft,Yt),nt(Ft,U),Pe(be,Yt,mn),Pe(he,u,gn),Pe(ye,u,vn)):rt(Ft,U),an(),cn(),0!==t?Ye("create",[l]):l},l.update=function(e,t){return l.is.create&&l.destroy(0),(0!==t?Ye("update",[l]):l).create(e,0)},l.destroy=function(e){return l.is.create?(l.is.create=!1,Ot.exit(0,0,0),rt(Kt,St),D.tools=Oe(D.tools),D.keys&&(Re(de,Kt,dn),Re(pe,Kt,pn)),D.resize&&(Re(be,Yt,mn),Re(he,u,gn),Re(ye,u,vn)),tn?(kt(Ft,tn),zt(tn,Kt),tn=0):kt(Ft,Kt),_t(Ft),0!==e?Ye("destroy",[l]):l):l},l.enable=function(e){return Kt.disabled=Kt.readOnly=!1,nt(Ft,Dt+"-is-can-update"),nt(Ft,Dt+"-is-can-copy"),0!==e?Ye("enable",[l]):l},l.disable=function(e){return Kt.disabled=!0,rt(Ft,Dt+"-is-can-update"),rt(Ft,Dt+"-is-can-copy"),0!==e?Ye("disable",[l]):l},l.freeze=function(e){return Kt.disabled=!1,Kt.readOnly=!0,rt(Ft,Dt+"-is-can-update"),nt(Ft,Dt+"-is-can-copy"),0!==e?Ye("freeze",[l]):l},Ot.exit=function(e,t,n){if(F={panel:function(){_t(Rt)},overlay:function(){Re(se,Ut,kn),_t(Ut)},modal:function(){Re(se+" "+de,xn.x,wn),Re(be,Wt,Tn),Re(he,Wt,zn),Re(ye,u,$n),_t(Zt)},drop:function(){Re(se,u,Cn),Re(me,s,Cn),_t(Gt)},bubble:function(){_t(Jt)}},pn(),t)if($(t))for(X in t)X=t[X],F[X]&&F[X](),0!==n&&Ye("exit."+X,[l]);else F[t]&&F[t](),0!==n&&Ye("exit."+X,[l]);else for(X in F)F[X]();return e&&l.select(),0!==n&&Ye("exit",[l]),l},Ot.panel=function(e,t,n,i){function r(e){return Re(se+" "+de,ie,r),Ot.panel.exit(1),Ke(e)}return Ot.exit(0,0,0),P=Je(e),V=0,i&&(P+=" "+P+"--"+Je(i)),$(t)&&!E(t)&&(V=Mt(Dt+"-panel-header "+P,0,t.header),t=t.body),ee=Mt(Dt+"-panel-body "+P,0,Mt(Dt+"-panel-content "+P,0,T(t)?"":t)),T(t)&&t(ee),ie=ot("a",!1,{href:Le,"class":Dt+"-a "+Dt+"-x "+P}),ie.title=At.close,ot(Rt,!1,{"class":Dt+"-panel "+P}),Pe(se+" "+de,ie,r),at(Rt,0),V&&zt(Rt,V),zt(Wt,ot(Rt,[ee,ie])),T(n)?n(Rt):_(n)&&ot(Rt,n),A=[l,Rt],i&&Ye("enter.panel."+e+":"+i,A),Ye("enter.panel."+e,A),Ye("enter.panel",A),Ye("enter",A),ie.focus(),l},Ot.panel.fit=function(){},Ot.overlay=function(e,t,n,i){return Ot.exit(0,0,0),P=Je(e),i&&(P+=" "+P+"--"+Je(i)),zt(Wt,ot(Ut,!1,{"class":Dt+"-overlay "+P})),t&&Pe(se,Ut,kn),T(n)?n(Ut):_(n)&&ot(Ut,n),A=[l,Ut],i&&Ye("enter.overlay."+e+":"+i,A),Ye("enter.overlay."+e,A),Ye("enter.overlay",A),Ye("enter",A),l},Ot.overlay.fit=function(){},Ot.message=function(e,t,n,i,r){function o(e){return Re(se+" "+de,ie,o),y(f),Ot.overlay.exit(1),Ke(e)}var f;return P=Je(e),r&&(P+=" "+P+"--"+Je(r)),ie=ot("a",!1,{href:Le,"class":Dt+"-a "+Dt+"-x "+P}),ie.title=At.close,ot(Qt,T(t)?t(Qt):t,{"class":Dt+"-message "+P}),Pe(se+" "+de,ie,o),Ot.overlay("message message-"+P,0,function(e){zt(Qt,ie),n&&(f=x(function(){o()},n)),zt(e,Qt)},r),T(i)?i(Qt):_(i)&&ot(Qt,i),l},Ot.modal=function(){var s,a,e=arguments,t=e[0],n=e[1],i=e[2],r=e[3],f=Dt+"-modal",o=n.footer;if($(t)&&(t="default",n=e[0],i=e[1],r=e[2]),Ot.overlay(t,1,0,r).blur(),P=Je(t),r&&(P+=" "+P+"--"+Je(r)),ot(Zt,!1,{"class":f+" "+P}),C(n.body)&&(n.body=ot("div",n.body,{"class":f+"-content "+P})),C(o)&&$(o)&&!E(o)){a=[];for(X in o)q=o[X],E(q)?a.push(q):(q=on(q,X,o),K=X.text||At[X]||X,s=ot("button",K,b({name:"y["+X+"]",type:"button","class":Dt+"-button",data:{"button-id":X}},q.attributes)),Pe(se,s,function(e){return K=o[Xe(this,"button-id")].click(e,l),K===!1?Ke(e):void 0}),a.push(s));n.footer=a}for(X in n)f[1]=X,xn[X]=Mt(f+"-"+Ge(X,f)+" "+P,0,n[X]);return xn.x=ot("a",!1,{href:Le,"class":Dt+"-a "+Dt+"-x "+P}),xn.sizer=jt,at(Zt,0),xn.x.title=At.close,zt(Wt,ot(Zt,xn,{style:""})),Ot.modal.fit(),Et(Zt,Ut),Pe(se+" "+de,xn.x,wn),Pe(be,xn.header,Ke),Pe(be,xn.sizer,Ke),Pe(be,Wt,Tn),Pe(he,Wt,zn),Pe(ye,u,$n),T(i)&&i(xn),A=[l,Zt,xn],r&&Ye("enter.modal."+t+":"+r,A),Ye("enter.modal."+t,A),Ye("enter.modal",A),Ye("enter",A),xn.x.focus(),l},Ot.modal.fit=function(e){return En(),P=hn/2-ne/2,V=yn/2-W/2,$(e)?(C(e[0])&&(P=e[0]),C(e[1])&&(V=e[1])):(P=d(P,0),V=d(V,0)),c(Zt,{left:P+Ce,top:V+Ce,"min-width":ne+Ce,"min-height":W+Ce,visibility:"visible"}),A=[l,Zt,xn],Ye("fit.modal",A),Ye("fit",A),l};var _n={"class":Dt+"-button",name:"y"};return Ot.alert=function(e,t,n,i,r){var f=ot("button",At.okay,_n),o="alert";return n=n||v,$(e)&&(o+=":"+e[0],e=e[1]||e[0]),Pe(se,f,function(e){return n(e,l),wn(e,o+".y")}),Pe(de,f,function(e){var t=e.TE.key;return t(["enter","escape"])&&Ue(se,f,[e]),Ke(e)}),Ot.modal(o,Ln(e,t,f),i,r),f.focus(),l},Ot.confirm=function(e,t,n,i,r,f){function c(e){return T(n)&&n(e,l),wn(e,u+".y")}function d(e){return T(i)&&i(e,l),wn(e,u+".n")}var a,o=ot("button",At.okay,_n),s=ot("button",At.cancel,_n),u="confirm";return s.name="n",Pe(se,o,c),Pe(se,s,d),Pe(de,o,function(e){return a=e.TE.key,a("right")?s.focus():a("enter")?c(e):a("escape")&&wn(e,u+".y"),Ke(e)}),Pe(de,s,function(e){return a=e.TE.key,a("left")?o.focus():a("enter")?d(e):a("escape")&&wn(e,u+".n"),Ke(e)}),Ot.modal(u,Ln(e,t,[o,s]),r,f),s.focus(),l},Ot.prompt=function(e,t,n,i,r,f,o){function y(){a.focus(),"placeholder"in a&&a.select()}function x(e){return p=a.value,T(n)&&!n(p)?y():!n||m(p)&&p!==t?(wn(e,c+".y"),i(e,l,p!==t?p:"",t)):y(),Ke(e)}function g(e){return wn(e,c+".n")}var p,b,h,s=ot("button",At.okay,_n),u=ot("button",At.cancel,_n),a=ot("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":Dt+"-input block"}),c="prompt",d=[];if(r=r||0,1===r)a=ot("textarea",t,{placeholder:t.split("\n")[0],"class":Dt+"-textarea block",spellcheck:"false"});else if(2===r){for(X in t)d.push(ot("option",t[X],{value:X,selected:X===n||null}));a=ot("select",d,{"class":Dt+"-select block"})}return i=i||v,a.name="data",u.name="n",Pe(de,a,function(e){return b=e.TE.key,h=e.TE.control,b("enter")&&0===r||h("enter")?x(e):b("escape")||b("back")&&!this.value?g(e):b("down")&&0===r||b("enter")&&2===r||h("down")?(s.focus(),Ke(e)):void 0}),Pe(de,s,function(e){return b=e.TE.key,b("enter")?x(e):b("escape")?g(e):b("up")?a.focus():b("right")&&u.focus(),Ke(e)}),Pe(de,u,function(e){return b=e.TE.key,b(["enter","escape"])?g(e):b("up")?a.focus():b("left")&&s.focus(),Ke(e)}),Pe(se,s,x),Pe(se,u,g),Ot.modal(c,Ln(e,a,[s,u]),f,o),y(),l},Ot.drop=function(){Ot.exit(0,0,0);var e=arguments,t=e[0],n=e[1],i=e[2];return 1===He(e)&&(t="default",n=e[0],i=e[1]),P=Je(t),at(Gt,0),zt(N,ot(Gt,!1,{"class":Dt+"-drop "+P})),T(n)?n(Gt):ot(Gt,n),Ot.drop.fit(),i===!1||(Pe(se,u,Cn),Pe(me,s,Cn)),A=[l,Gt],Ye("enter.drop."+t,A),Ye("enter.drop",A),l},Ot.drop.fit=function(e){return A=et(M),B=et(Gt),S=Ot.drop.target,P=A.w/2-B.w/2,V=A.h/2-B.h/2,!C(e)&&S&&(t=Ve(S),P=t.l,V=t.t+et(S).h),$(e)?(C(e[0])&&(P=e[0]),C(e[1])&&(V=e[1])):(P=d(P,0,A.w-B.w),V=d(V,0,Math.max(A.h,et(s).h)-B.h)),c(Gt,{left:P+Ce,top:V+Ce,visibility:"visible"}),A=[l,Gt],Ye("fit.drop",A),Ye("fit",A),l},Ot.menu=function(e,n,i,r){var s,f=Ot.tools,o=0;if(n===!1)return Ot.tool(e,n);for(r in i)ne="%"===r[0],s=i[r],s=_(s)&&!ne?f[s]:s,s&&(s=on(s,r,f),i[r]=s);return Ot.tool(e,{i:$(n)?n[0]:0,text:$(n)?n[1]||0:n&&i[n]&&i[n].text||n,click:function(u){var a=Ot.drop.target=f[e].target;return Ot.drop("menu menu-"+Je(e),function(u){function c(o){return V=this,t=Xe(V,"tool-id"),R=i[t],R=_(R)?f[R]:R||{},U=lt(V),!fn(R)&&T(r=R.click)&&(r=r(o,l),R.i&&(f[e].i=R.i),Ot.menu.set(e,$(R.text)?[R.text[0],t]:$(n)?[n[0],t]:t),r===!1)?(l.select(),Ke(o)):(l.select(),Ke(o))}function d(e){if(V=this,(K=e.TE.key)("escape"))Ot.exit(1);else if(K("enter"))Ue(se,V,[e]);else if(K("f10")&&a)a.focus();else if(K("down")&&(P=ht(V))){for(;!mt(P,"a")&&P;)P=ht(P);P&&P.focus()}else if(K("up")&&(P=yt(V))){for(;!mt(P,"a")&&P;)P=yt(P);!P&&a?(Ot.exit(),a.focus()):P&&P.focus()}else K("up")&&a&&(Ot.exit(),a.focus());return Ke(e)}for(r in i)if(s=i[r],ne="%"===r[0],s){var p={href:ne?null:Le,"class":Dt+"-"+(ne?"label":"button")};ne?q=Bt[e]&&Bt[e][+r.slice(1)-1]||r:(p.data={},p.data["tool-id"]=r,q=Ht[r]||r),J=s.text,J=$(J)?J[1]||"":J,q=$(q)?q[0]:q,Q=ot(ne?"span":"a","<span>"+(ne?q||"%"+o:J||q)+"</span>",b(p,s.attributes||{})),nt(Q,"menu-"+Je(r).replace(/[\/\s]/g,"-")),!p.title&&(V=s.title)&&(Q.title=$(V)?V[0]+(V[1]?" ("+V[1]+")":""):V),ne?je(Q,{id:Dt+"-label:"+o}):(fn(s)?nt(Q,"x"):rt(Q,"x"),s.on?nt(Q,"on"):rt(Q,"on"),Pe(se,Q,c),Pe(de,Q,d)),zt(u,Q),++o}x(function(){(gt('[data-tool-id="'+Xe(a,ln)+'"]',u)[0]||gt("a",u)[0]).focus()},1)}),!1}},r),We(f[e].target,{"ui-drop":e}),f[e].data=i,Ot.menu.set(e,n)},Ot.menu.set=function(e,t){var f,o,n=Ot.tools[e]||{},i=n.target,r=n.data;return i?($(t)?We(i,ln,t[1]||""):(We(i,ln,t),t=r[t]&&r[t].text||t),$(t)?(o=t[0],o=Ne(o,"<")?o:Ot.i(o,n.i),t=C(t[1])?t[1]:0,t=t&&r[t]&&r[t].text||t,t=o+(0!==t?"<span>"+($(t)?t[1]||t:t)+"</span>":"")):o=Ot.i(e,n.i),(f=gt("."+Dt+"-text",i)[0])?(nt(i,"text"),ut(f,t)):(rt(i,"text"),ut(i,o)),l):l},Ot.bubble=function(){Ot.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===He(e)&&(t="default",n=e[0]),P=Je(t),at(Jt,0),zt(N,ot(Jt,!1,{"class":Dt+"-bubble "+P})),T(n)?n(Jt):ot(Jt,n),Ot.bubble.fit(),A=[l,Jt],Ye("enter.bubble."+t,A),Ye("enter.bubble",A),l},Ot.bubble.fit=function(e){Q=l.$(1),t=Ve(Kt),W=c(Kt,"line-height");var n="border-",i="-width";P=Q.caret[0].x+t.l-Kt.scrollLeft,V=Q.caret[1].y+t.t+W-Kt.scrollTop,B=c(Wt,[n+"top"+i,n+"bottom"+i,n+"left"+i,n+"right"+i]);var r=et(Wt),f=et(Jt),o=B[0]+B[1],s=B[2]+B[3];return $(e)?(C(e[0])&&(P=e[0]),C(e[1])&&(V=e[1])):(P=d(P,t.l,t.l+r.w-f.w-s),V=d(V,t.t,t.t+r.h-f.h-o)),c(Jt,{left:P+Ce,top:V+Ce,visibility:"visible"}),A=[l,Jt],Ye("fit.bubble",A),Ye("fit",A),l},Ot.panel.exit=function(e){return Ot.exit(e,"panel")},Ot.overlay.exit=function(e){return Ot.exit(e,"overlay")},Ot.modal.exit=function(e){return Ot.exit(e,"modal")},Ot.drop.exit=function(e){return Ot.exit(e,"drop")},Ot.bubble.exit=function(e){return Ot.exit(e,"bubble")},Ot.tool=function(e,t,n){var i=Ot.tools;return q="",K=C(i[e])?"update":"create","|"!==e&&(D.tools=Me(D.tools||"").filter(function(t,n){return t===e?(q=n,!1):!0})),t===!1?(delete i[e],K="destroy"):("|"===e?(n=t,t={}):(T(t)&&(t={click:t}),i[e]=b(i[e]||{},t),C(n)||""===q||(n=q)),z(n)?D.tools.splice(n,0,e):D.tools.push(e)),Ye(K+".tool."+e,[l,i[e]]),an(),l},Ot.separator=function(e,t){return Ot.tool("|",e!==!1?{attributes:e||{}}:!1,t)},Ot.key=function(e,t){var n=Ot.keys;return K=C(n[e])?"update":"create",t===!1?(delete n[e],K="destroy"):n[e]=t,Ye(K+".key."+e,[l,n[e]]),cn(),l},Ot.key.set=function(e){H[e]=1},Ot.key.reset=function(e){e?delete H[e]:H={}},Ot.tools={"|":{},undo:{click:function(e,t){return t.undo(),!1}},redo:{click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(Ee),!1},outdent:function(e,t){return t.outdent(Ee),!1}},Ot.keys={"control+y":"redo","control+z":"undo",escape:function(e,t){return J=":not([tabindex]):not([disabled])",(Q=gt("input"+J+",button"+J+",select"+J+",textarea"+J+",a[href]"+J+",[contenteditable]"+J+',[tabindex]:not([tabindex="-1"])',u,0))&&-1!==(V=Q.indexOf(Kt))?((Q[V+1]||u).focus(),!1):void 0},f10:function(e,t){return gt("a",qt)[0].focus(),!1},tab:ve?"indent":0,"shift+tab":ve?"outdent":0},Ot.el={container:Ft,header:It,body:Wt,footer:Xt,panel:Rt,overlay:Ut,modal:Zt,drop:Gt,bubble:Jt},l.config=D,b(TE._,{time:function(e){var t=new Date(C(e)?e:Date.now()),n=t.getFullYear(),i=t.getMonth()+1,r=t.getDate(),f=t.getHours(),o=t.getMinutes(),s=t.getSeconds(),u=t.getMilliseconds();return 10>i&&(i="0"+i),10>r&&(r="0"+r),10>f&&(f="0"+f),10>o&&(o="0"+o),10>s&&(s="0"+s),10>u&&(u="0"+u),[""+n,""+i,""+r,""+f,""+o,""+s,""+u]},replace:Ze,format:Ge,dom:{set:zt,reset:$t,get:gt,id:st,copy:Lt,replace:Ct,classes:{set:nt,reset:rt,toggle:ft,get:it},attributes:{set:je,reset:Ie,get:Fe},data:{set:We,reset:qe,get:Xe},is:mt,offset:Ve,pointer:Qe,size:et,content:{set:ut,reset:at,get:lt},closest:tt,parent:dt,children:pt,closest:bt,next:ht,previous:yt,index:xt,before:kt,after:Et,prepend:wt,append:Tt},el:ot,events:{set:Pe,reset:Re,fire:Ue,x:Ke}}),b(l._,TE._),b(l._,{hooks:{set:Be,reset:Se,fire:Ye}}),l.create()},TE.plugs={},TE.plug=function(e,t,n){var i=document,r=/\.css$/i.test(e),f=i.createElement(r?"link":"script");return r?(f.href=e,f.rel="stylesheet"):f.src=e,TE.plugs[e]=f,(n||i.head).appendChild(f),TE};