!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";var e=function(e){return function(e){return void 0!==e}(e)&&!function(e){return null===e}(e)},t=function(e){return e&&e.preventDefault()},n=function(e,t){return e in t},r=function(e,t){return void 0===t&&(t=""),e.replace(u("["+t+c.replace(/./g,"\\$&")+"]"),"\\$&")},o=function(t){return function(t,n){return t&&e(n)&&t instanceof n}(t,RegExp)},u=function(t,n){return o(t)?t:(t=t.replace(/\//g,"\\/"),RegExp(t,e(n)?n:"g"))},c="!$^*()+=[]{}|:<>,.?/-";const l=TE;function i(e,o={}){const c=this;l.call(c,e,o),o=c.state;let i=n("source",o)?o.source:{};if(!i)return c;let s={},f=c.pop,a=n("undo",l.prototype);s.close={"`":"`","(":")","{":"}","[":"]",'"':'"',"'":"'","<":">"},s.pull=e=>{let t=e.key,n=e.keyCode,r=e.ctrlKey,o=e.shiftKey;return r&&!o&&(t&&"["===t||n&&219===n)},s.push=e=>{let t=e.key,n=e.keyCode,r=e.ctrlKey,o=e.shiftKey;return r&&!o&&(t&&"]"===t||n&&221===n)},i&&(o.source=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return Object.assign.apply(Object,[{}].concat(t))}(s,!0===o.source?{}:o.source));let p=o.source||{};function d(n){if(e.disabled||e.readOnly)return;let l=p.close,i=o.tab,s=function(e){return e.toLowerCase()}(n.key||String.fromCharCode(k)),f=n.keyCode,a=n.ctrlKey,d="enter"===s||13===f;n.shiftKey;let{after:h,before:v,end:b,start:m,value:g}=c.$(),$=v.slice(-1),C=h.slice(0,1),E=v.match(u("(?:^|\\n)("+r(i)+"+).*$","")),K=E?E[1]:"",w=l[s];if(p.push&&p.push.call(c,n))c.push(i),y(),t(n);else if(p.pull&&p.pull.call(c,n))c.pull(i),y(),t(n);else if(a)"z"===s||90===f?(c.undo(),y(),t(n)):"y"!==s&&89!==f||(c.redo(),y(),t(n));else if("\\"!==$&&s===C)c.select(b+1),y(),t(n);else if("\\"!==$&&w)y(),c.wrap(s,w),y(),t(n);else if("backspace"===s||8===f){let e="",o="";for(let t in l)e+=t,o+=l[t];e="(["+r(e)+"])",o="(["+r(o)+"])";let s=v.match(u(e+"\\n(?:"+r(K)+")$","")),f=h.match(u("^\\n(?:"+r(K)+")"+o,""));!g&&s&&f&&f[1]===l[s[1]]?(c.trim("",""),y(),t(n)):!g&&v.match(u(r(i)+"$",""))?(c.pull(i),y(),t(n)):(w=l[$],w&&w===C&&"\\"!==v.slice(-2,-1)&&(c.peel($,C),t(n))),y()}else"delete"===s||46===f?(w=l[$],w&&w===C&&(c.peel($,C),t(n)),y()):d?(w=l[$],w&&w===C?(c.wrap("\n"+i+K,"\n"+K).blur().focus(),t(n)):(g||K)&&(c.insert("\n",-1,!0).push(K).blur().focus(),t(n)),y()):setTimeout(y,0)}function y(){a&&c.record()}var h,v,b;return i&&(h="keydown",v=d,void 0===b&&(b=!1),e.addEventListener(h,v,b),y()),c.pop=()=>(function(e){return"function"==typeof e}(f)&&f.call(c),function(e,t,n){t.removeEventListener(e,n)}("keydown",e,d),a&&c.loss(!0),c),c.state=o,c}i.prototype=function(e){return Object.create(e)}(l.prototype),i.prototype.constructor=i;for(let e in l)i[e]=l[e];TE=i}));