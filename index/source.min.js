/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2020 Taufik Nurrohman
 *
 * <https://github.com/taufik-nurrohman/text-editor>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(){"use strict";var e=function(e){return function(e){return void 0!==e}(e)&&!function(e){return null===e}(e)},r=function(e){return e&&e.preventDefault()},n=function(e,r){return void 0===r&&(r=""),e.replace(o("["+r+u.replace(/./g,"\\$&")+"]"),"\\$&")},t=function(r){return function(r,n){return r&&e(n)&&r instanceof n}(r,RegExp)},o=function(r,n){return t(r)?r:(r=r.replace(/\//g,"\\/"),RegExp(r,e(n)?n:"g"))},u="!$^*()+=[]{}|:<>,.?/-";if(e(TE)){var c=function(e,t){void 0===t&&(t={});var u=this;i.call(u,e,t);var c="source"in(t=u.state)?t.source:{};if(!c)return u;var l={},a=u.pop,s="undo"in i.prototype;l.close={"`":"`","(":")","{":"}","[":"]",'"':'"',"'":"'","<":">"},l.pull=function(e){var r=e.key,n=e.keyCode;return e.ctrlKey&&(r&&"["===r||n&&219===n)},l.push=function(e){var r=e.key,n=e.keyCode;return e.ctrlKey&&(r&&"]"===r||n&&221===n)},c&&(t.source=function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return Object.assign.apply(Object,[{}].concat(r))}(l,!0===t.source?{}:t.source));var f,p,v,d=t.source||{};function y(c){if(!e.disabled&&!e.readOnly){var i=d.close,l=t.tab,a=function(e){return e.toLowerCase()}(c.key||String.fromCharCode(k)),s=c.keyCode,f=c.ctrlKey,p="enter"===a||13===s,v=(c.shiftKey,u.$()),y=v.before,b=v.value,g=v.after,m=y.slice(-1),E=g.slice(0,1),$=y.match(o("(?:^|\\n)("+n(l)+"+).*$","")),C=$?$[1]:"",w=i[a];if(d.push&&d.push.call(u,c))u.push(l),h(),r(c);else if(d.pull&&d.pull.call(u,c))u.pull(l),h(),r(c);else if(f)"z"===a||90===s?(u.undo(),h(),r(c)):"y"!==a&&89!==s||(u.redo(),h(),r(c));else if("\\"!==m&&a===E)u.select(v.end+1),h(),r(c);else if("\\"!==m&&w)h(),u.wrap(a,w),h(),r(c);else if("backspace"===a||8===s){var K="",O="";for(var T in i)K+=T,O+=i[T];K="(["+n(K)+"])",O="(["+n(O)+"])";var j=y.match(o(K+"\\n(?:"+n(C)+")$","")),L=g.match(o("^\\n(?:"+n(C)+")"+O,""));!b&&j&&L&&L[1]===i[j[1]]?(u.trim("",""),h(),r(c)):!b&&y.match(o(n(l)+"$",""))?(u.pull(l),h(),r(c)):(w=i[m])&&w===E&&(u.peel(m,E),r(c)),h()}else"delete"===a||46===s?((w=i[m])&&w===E&&(u.peel(m,E),r(c)),h()):p?((w=i[m])&&w===E?(u.wrap("\n"+l+C,"\n"+C).blur().focus(),r(c)):(b||C)&&(u.insert("\n",-1,!0).push(C).blur().focus(),r(c)),h()):setTimeout(h,0)}}function h(){s&&u.record()}return c&&(f="keydown",p=y,void 0===v&&(v=!1),e.addEventListener(f,p,v),h()),u.pop=function(){return function(e){return"function"==typeof e}(a)&&a.call(u),function(e,r,n){r.removeEventListener(e,n)}("keydown",e,y),s&&u.loss(!0),u},u.state=t,u},i=TE;for(var l in(c.prototype=Object.create(i.prototype)).constructor=c,i)c[l]=i[l];TE=c}}();