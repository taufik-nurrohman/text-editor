/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2020 Taufik Nurrohman
 *
 * <https://github.com/taufik-nurrohman/text-editor>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(){"use strict";var e=function(e){return function(e){return void 0!==e}(e)&&!function(e){return null===e}(e)},r=function(e){return e&&e.preventDefault()},n=function(e,r){return e in r},t=function(e,r){return void 0===r&&(r=""),e.replace(u("["+r+c.replace(/./g,"\\$&")+"]"),"\\$&")},o=function(r){return function(r,n){return r&&e(n)&&r instanceof n}(r,RegExp)},u=function(r,n){return o(r)?r:(r=r.replace(/\//g,"\\/"),RegExp(r,e(n)?n:"g"))},c="!$^*()+=[]{}|:<>,.?/-";if(e(TE)){var i=function(e,o){void 0===o&&(o={});var c=this;l.call(c,e,o),o=c.state;var i=n("source",o)?o.source:{};if(!i)return c;var a={},s=c.pop,f=n("undo",l.prototype);a.close={"`":"`","(":")","{":"}","[":"]",'"':'"',"'":"'","<":">"},a.pull=function(e){var r=e.key,n=e.keyCode,t=e.ctrlKey,o=e.shiftKey;return t&&!o&&(r&&"["===r||n&&219===n)},a.push=function(e){var r=e.key,n=e.keyCode,t=e.ctrlKey,o=e.shiftKey;return t&&!o&&(r&&"]"===r||n&&221===n)},i&&(o.source=function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return Object.assign.apply(Object,[{}].concat(r))}(a,!0===o.source?{}:o.source));var p,v,y,d=o.source||{};function h(n){if(!e.disabled&&!e.readOnly){var i=d.close,l=o.tab,a=function(e){return e.toLowerCase()}(n.key||String.fromCharCode(k)),s=n.keyCode,f=n.ctrlKey,p="enter"===a||13===s,v=(n.shiftKey,c.$()),y=v.after,h=v.before,g=v.end,m=(v.start,v.value),E=h.slice(-1),$=y.slice(0,1),C=h.match(u("(?:^|\\n)("+t(l)+"+).*$","")),K=C?C[1]:"",w=i[a];if(d.push&&d.push.call(c,n))c.push(l),b(),r(n);else if(d.pull&&d.pull.call(c,n))c.pull(l),b(),r(n);else if(f)"z"===a||90===s?(c.undo(),b(),r(n)):"y"!==a&&89!==s||(c.redo(),b(),r(n));else if("\\"!==E&&a===$)c.select(g+1),b(),r(n);else if("\\"!==E&&w)b(),c.wrap(a,w),b(),r(n);else if("backspace"===a||8===s){var O="",T="";for(var j in i)O+=j,T+=i[j];O="(["+t(O)+"])",T="(["+t(T)+"])";var L=h.match(u(O+"\\n(?:"+t(K)+")$","")),x=y.match(u("^\\n(?:"+t(K)+")"+T,""));!m&&L&&x&&x[1]===i[L[1]]?(c.trim("",""),b(),r(n)):!m&&h.match(u(t(l)+"$",""))?(c.pull(l),b(),r(n)):(w=i[E])&&w===$&&"\\"!==h.slice(-2,-1)&&(c.peel(E,$),r(n)),b()}else"delete"===a||46===s?((w=i[E])&&w===$&&(c.peel(E,$),r(n)),b()):p?((w=i[E])&&w===$?(c.wrap("\n"+l+K,"\n"+K).blur().focus(),r(n)):(m||K)&&(c.insert("\n",-1,!0).push(K).blur().focus(),r(n)),b()):setTimeout(b,0)}}function b(){f&&c.record()}return i&&(p="keydown",v=h,void 0===y&&(y=!1),e.addEventListener(p,v,y),b()),c.pop=function(){return function(e){return"function"==typeof e}(s)&&s.call(c),function(e,r,n){r.removeEventListener(e,n)}("keydown",e,h),f&&c.loss(!0),c},c.state=o,c},l=TE;for(var a in(i.prototype=function(e){return Object.create(e)}(l.prototype)).constructor=i,l)i[a]=l[a];TE=i}}();